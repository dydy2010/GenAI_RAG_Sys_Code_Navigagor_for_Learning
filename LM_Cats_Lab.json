{"name": "LM_Cats_Lab", "extension": ".R", "course": "MPM01", "st_mode": 33204, "st_ino": 13100103, "st_dev": 16777233, "st_nlink": 1, "st_uid": 501, "st_gid": 20, "st_size": 8731, "st_atime": 1759510056.2928948, "st_mtime": 1759493998.0, "st_ctime": 1759510056.176605, "st_birthtime": 1759493998.0, "st_blocks": 24, "st_blksize": 4096, "content": "## ----getData-------------------------------------------------------\nd.cats <- read.csv(\"../../Datasets/Cats.csv\", \n                   header = TRUE, \n                   stringsAsFactors = TRUE)\n##\nstr(d.cats)\nhead(d.cats)\n\n\n## ----graphBody.weight, out.width='0.8\\\\linewidth'------------------\nplot(Heart.weight ~ Body.weight, data = d.cats,\n     main = \"Heart weight against body weight\")\n\n\n## ----graphSex, out.width='0.8\\\\linewidth'--------------------------\nboxplot(Heart.weight ~ Sex, data = d.cats,\n        main = \"Heart weight against sex\",\n        ylab = \"Heart.weight\")\n\n\n## ----graphBothPredictors-------------------------------------------\nplot(Heart.weight ~ Body.weight, data = d.cats,\n     col = Sex, \n     pch = 19,\n     main = \"Heart weight against body weight\")\n##\nlegend(\"topleft\", \n       pch = 19,\n       legend = c(\"F\",\"M\"), \n       col = c(1, 2))\n\n\n## ----graphQplot, echo=FALSE, eval=FALSE----------------------------\n# library(ggplot2)\n# qplot(y = Heart.weight, x = Body.weight,\n#       data = d.cats,\n#       facets = ~ Sex)\n\n\n## ----graphGGplot---------------------------------------------------\nlibrary(ggplot2)\nggplot(data = d.cats, \n       mapping = aes(y = Heart.weight, x = Body.weight)) +\n  geom_point() +\n  facet_wrap(~ Sex)\n\n\n## ----ggplotWithRegressionLine, echo=FALSE, message=FALSE-----------\nggplot(data = d.cats,\n       mapping = aes(y = Heart.weight, x = Body.weight)) +\n  geom_point() +\n  facet_grid(. ~ Sex) +\n  geom_smooth(method = \"lm\", se = FALSE)\n\n\n## ----fitRegression-------------------------------------------------\nlm.cats <- lm(Heart.weight ~ Body.weight, data = d.cats)\n\n\n## ----summaryLmCatsSimple-------------------------------------------\nsummary(lm.cats)\n\n\n## ----coefRegression------------------------------------------------\ncoef(lm.cats)\n\n\n## ----visualiseSimpleRegression, echo=FALSE-------------------------\nplot(Heart.weight ~ Body.weight, data = d.cats,\n     xlim = c(0,4), \n     ylim = c(-0.5, 20))\n##\ngrid()\n##\nabline(a = coef(lm.cats)[1],\n       b = coef(lm.cats)[2],\n       col = \"red\", lty = \"dashed\")\n## equivalent to:\n# abline(lm.cats)\n\n\n\n\n\n\n## ----addingSex-----------------------------------------------------\nlm.cats.2 <- lm(Heart.weight ~ Body.weight + Sex, data = d.cats)\n\n\n## ----summaryLmCats2------------------------------------------------\nsummary(lm.cats.2)\n\n\n## ----graphFitLmCats2, echo=FALSE-----------------------------------\nplot(Heart.weight ~ Body.weight, data = d.cats,\n     main = \"Model 'lm.cats.2'\",\n     col = Sex)\n##\nlegend(\"topleft\", \n       pch = 19,\n       legend = c(\"F\",\"M\"), \n       col = c(\"black\", \"red\"))\n##\nabline(a = coef(lm.cats.2)[1],\n       b = coef(lm.cats.2)[\"Body.weight\"])\nabline(a = coef(lm.cats.2)[1] + coef(lm.cats.2)[\"SexM\"] ,\n       b = coef(lm.cats.2)[\"Body.weight\"],\n       col = \"red\")\n\n\n## ----coefLmCats2---------------------------------------------------\ncoef(lm.cats.2)\n\n\n## ----interceptSexes------------------------------------------------\n## intercept females:\ncoef(lm.cats.2)[\"(Intercept)\"] \n##\n## intercept males:\ncoef(lm.cats.2)[\"(Intercept)\"] + coef(lm.cats.2)[\"SexM\"]\n\n\n\n\n## ----fitCatsLmWithInteraction--------------------------------------\nlm.cats.3 <- lm(Heart.weight ~ Body.weight * Sex, data = d.cats)\n\n\n## ----graphFitLmCats3, echo=FALSE-----------------------------------\nplot(Heart.weight ~ Body.weight, data = d.cats,\n     main = \"Model 'lm.cats.3'\",\n     xlim = c(0, 4), \n     ylim = c(-5, 21),\n     col = Sex)\n##\ngrid()\n##\nabline(h = 0, lwd = 0.5)\nabline(v = 0, lwd = 0.5)\n##\nabline(a = coef(lm.cats.3)[1],\n       b = coef(lm.cats.3)[\"Body.weight\"])\nabline(a = coef(lm.cats.3)[1] + coef(lm.cats.3)[\"SexM\"] ,\n       b = coef(lm.cats.3)[\"Body.weight\"] + coef(lm.cats.3)[\"Body.weight:SexM\"],\n       col = \"red\")\n##\nlegend(\"topleft\", \n       pch = 19,\n       legend = c(\"F\",\"M\"), \n       col = c(\"black\", \"red\"))\n\n\n## ----coefLmCats3, eval=FALSE---------------------------------------\n# coef(lm.cats.3)\n\n\n\n\n## ----fitLmCats3Bis-------------------------------------------------\nlm.cats.3.bis <- lm(Heart.weight ~ Body.weight + Sex + Body.weight:Sex, data = d.cats)\n\n\n\n\n## ----confintLmCats3------------------------------------------------\n## regression coefficients\ncoef(lm.cats.3)\n##\n## confidence intervals\nconfint(lm.cats.3)\n\n\n## ----GraphsCisLmCats3, out.width='0.7\\\\linewidth', echo=FALSE------\n## 1) estimate CIs\ncis.lm.cats.3 <- confint(lm.cats.3)\n##\n## 2) plot estimates\npar(mar = c(4,5,2,2))\nplot(y = 1:4,\n     x = rev(coef(lm.cats.3)),\n     xlim = c(-9, 7),\n     xlab = \"Estimated coefficients\",\n     ylab = \"\",\n     axes = FALSE)\nbox()\naxis(side = 2, at = 1:4,\n     labels = rev(names(coef(lm.cats.3))), \n     las = 2)\naxis(side = 1)\n##\n## 3) plot CIs\nsegments(x0 = rev(cis.lm.cats.3[, \"2.5 %\"]),\n         x1 = rev(cis.lm.cats.3[, \"97.5 %\"]),\n         y0 = 1:4,\n         y1 = 1:4)\nabline(v = 0, lty = \"dashed\")\n\n\n## ----rSquared------------------------------------------------------\n## model with no interaction\nformula(lm.cats.2)\nsummary(lm.cats.2)$r.squared\n##\n## model with interaction\nformula(lm.cats.3)\nsummary(lm.cats.3)$r.squared\n\n\n## ----adjustedRsquared----------------------------------------------\nsummary(lm.cats.2)$adj.r.squared\nsummary(lm.cats.3)$adj.r.squared\n\n\n## ----fittedValues--------------------------------------------------\nfitted.cats <- fitted(lm.cats)\n##\nstr(fitted.cats)\nhead(fitted.cats)\n\n\n## ----fittedValuesPlot----------------------------------------------\nplot(Heart.weight ~ Body.weight, data = d.cats,\n     main = \"Model 'lm.cats'\",\n     col = \"darkgray\")\n##\npoints(fitted.cats ~ Body.weight, \n       col = \"purple\",\n       pch = 19,\n       data = d.cats)\n##\nabline(lm.cats, col = \"black\")\n\n\n## ----residuals-----------------------------------------------------\nresid.cats <- resid(lm.cats)\n##\nlength(resid.cats)\nhead(resid.cats)\n\n\n## ----randomResiduals-----------------------------------------------\nset.seed(20) ## for reproducibility\nid <- sample(x = 1:144, size = 5)\nresid.cats[id]\nfitted.cats[id]\n\n\n## ----plotResiduals-------------------------------------------------\nplot(Heart.weight ~ Body.weight, data = d.cats,\n     main = \"Model 'lm.cats'\",\n     col = \"lightgray\")\n##\nabline(lm.cats)\n##\npoints(Heart.weight ~ Body.weight, data = d.cats[id, ], col = \"red\")\n##\nsegments(x0 = d.cats[id, \"Body.weight\"], x1 = d.cats[id, \"Body.weight\"],\n         y0 = fitted.cats[id], y1 = d.cats[id, \"Heart.weight\"],\n         col = \"blue\")\n\n\n## ----PredictionsNewCats--------------------------------------------\n## 1) create the new data\nnew.data.cats <- data.frame(Body.weight = c(4, 2.5, 3))\n##\n## 2) make predictions\npred.new.cats <- predict(object = lm.cats, newdata = new.data.cats)\n## \n## 3) display predictions\nplot(Heart.weight ~ Body.weight, \n     data = d.cats,\n     xlim = c(2, 4))\nabline(lm.cats)\n##\npoints(x = new.data.cats$Body.weight,\n       y = pred.new.cats, \n       col = \"purple\",\n       pch = 19, cex = 1.5)\n\n\n## ----PredictionsNewCatsCIs-----------------------------------------\npred.new.cats.ci <- predict(object = lm.cats, \n                            interval = \"prediction\",\n        newdata = new.data.cats)\npred.new.cats.ci\n\n\n## ----PredictionsNewCatsCIsGraphs-----------------------------------\nplot(Heart.weight ~ Body.weight, \n     data = d.cats,\n     xlim = c(2, 4))\nabline(lm.cats)\n##\npoints(x = new.data.cats$Body.weight,\n       y = pred.new.cats.ci[, \"fit\"], \n       col = \"purple\",\n       pch = 19, cex = 1.5)\n##\nsegments(x0 = new.data.cats$Body.weight, \n         x1 = new.data.cats$Body.weight,\n         y0 = pred.new.cats.ci[, \"lwr\"],\n         y1 = pred.new.cats.ci[, \"upr\"],\n         lwd = 2,\n         col = \"purple\")\n\n\n## ----TreatmentContrastsThreeLevels---------------------------------\n## 1) add the new level first\nlevels(d.cats$Sex)\n##\nlevels(d.cats$Sex) <- c(\"F\", \"M\", \"Unknown\")\n##\nlevels(d.cats$Sex)\n##\n## 2) set the first 10 observations to unknown\nd.cats$Sex[1:10] <- \"Unknown\"\n##\n## 3) fit a simple model \nlm.cats.Newsex <- lm(Heart.weight ~ Sex, data = d.cats)\n##\n## 4) look at the coefficients\ncoef(lm.cats.Newsex)\n\n\n## ----changingReference---------------------------------------------\n## 1) change reference level\nlevels(d.cats$Sex)\n##\nd.cats$Sex <- relevel(d.cats$Sex, ref = \"M\")\n##\nlevels(d.cats$Sex)\n##\n## 2) refit model\nlm.cats.relevelled <- lm(Heart.weight ~ Sex, data = d.cats)\ncoef(lm.cats.relevelled)\n\n\n## ----simpleModel---------------------------------------------------\nformula(lm.cats)\ncoef(lm.cats)\n\n\n## ----modelMatrixBody.weight----------------------------------------\nX <- model.matrix(lm.cats)\ndim(X)\nhead(X)\n\n\n## ----getBetasSimpleModel-------------------------------------------\ny <- model.frame(lm.cats)$Heart.weight\nbetas.lm.cats <- solve(t(X) %*% X) %*% t(X) %*% y\nbetas.lm.cats\n\n"}