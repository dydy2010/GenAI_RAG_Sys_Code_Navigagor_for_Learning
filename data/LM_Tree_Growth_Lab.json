{"name": "LM_Tree_Growth_Lab", "extension": ".R", "course": "MPM01", "st_mode": 33204, "st_ino": 13100104, "st_dev": 16777233, "st_nlink": 1, "st_uid": 501, "st_gid": 20, "st_size": 6299, "st_atime": 1759510056.7562819, "st_mtime": 1759493998.0, "st_ctime": 1759510056.2149777, "st_birthtime": 1759493998.0, "st_blocks": 16, "st_blksize": 4096, "content": "## ----getData, results='hide'---------------------------------------\n## (results are hidden)\n##\nd.trees <- read.csv2(\"TreesChamagne2017_Lab_modified.csv\",\n                     stringsAsFactors = TRUE)\n##\nstr(d.trees)\nhead(d.trees)\n\n\n## ----plotSpecies---------------------------------------------------\nboxplot(growth.rate ~ species, data = d.trees)\n\n\n## ----fitLm1--------------------------------------------------------\nlm.trees.1 <- lm(growth.rate ~ species, data = d.trees)\ncoef(lm.trees.1)\n\n\n## ----pvaluesSpecies------------------------------------------------\nsummary(lm.trees.1)\n\n\n## ----fitLm0--------------------------------------------------------\nlm.trees.0 <- lm(growth.rate ~ 1, data = d.trees)\ncoef(lm.trees.0)\n\n\n## ----compareLm0AndLm1----------------------------------------------\nanova(lm.trees.0, lm.trees.1)\n\n\n## ----testOakVsSpruce, message=FALSE--------------------------------\nlibrary(multcomp)\nph.test.1 <- glht(model = lm.trees.1, \n                  linfct = mcp(species = \n                                 c(\"Oak - Spruce = 0\")))\nsummary(ph.test.1)\n\n\n## ----addingVariables-----------------------------------------------\nlm.trees.2 <- update(lm.trees.1, \n                     . ~ . + Density.tree.Class + SiteID)\n\n\n## ----checkFormulaLM2-----------------------------------------------\nformula(lm.trees.2)\n\n\n## ----Drop1OnLM2----------------------------------------------------\ndrop1(lm.trees.2, test = \"F\")\n\n\n## ----getUniqueSiteIDHead-------------------------------------------\nhead(unique(d.trees$SiteID))\n\n\n## ----siteAsFactor--------------------------------------------------\nd.trees$SiteID.fac <- factor(d.trees$SiteID)\n\n\n## ----fixingSiteIdPredictor-----------------------------------------\nlm.trees.3 <- update(lm.trees.2,\n                     . ~ . + SiteID.fac - SiteID)\n##\ndrop1(lm.trees.3, test = \"F\")\n\n\n## ----addingAge-----------------------------------------------------\nlm.trees.4 <- update(lm.trees.3, . ~ . + age)\n##\ndrop1(lm.trees.4, test = \"F\")\n\n\n## ----pvalueForAgeViaSummary----------------------------------------\ncapture.output(summary(lm.trees.4))[c(10,11,62)]\n\n\n## ----globalFtest---------------------------------------------------\nanova(lm.trees.0, lm.trees.4)\n\n\n## ----GlobalFTest---------------------------------------------------\ntail(capture.output(summary(lm.trees.4)))\n\n\n## ----SeqSS---------------------------------------------------------\nformula(lm.trees.4)\nanova(lm.trees.4)\n\n\n## ----SeqSSWithSpeciesAtEnd-----------------------------------------\nlm.trees.4.again <- lm(growth.rate ~ Density.tree.Class + SiteID.fac +\n                         age + species, \n                       data = d.trees)\nanova(lm.trees.4.again)\n\n\n## ----testref, ref.label='testOakVsSpruce'--------------------------\n\n\n## ----createVectorConifersBroadleavedOne----------------------------\nlevels(d.trees$species)\n##\n## vector of contrasts\nv.Oak_vs_Spruce <- c(0, 0, -1, 1)\nnames(v.Oak_vs_Spruce) <-\n  levels(d.trees$species)\n##\nv.Oak_vs_Spruce\n\n\n## ----testOakVsSpruceVector, message=FALSE--------------------------\nlibrary(multcomp)\nph.test.Q_vs_P <- glht(model = lm.trees.1, \n                  linfct = mcp(species = v.Oak_vs_Spruce))\nsummary(ph.test.Q_vs_P)\n\n\n## ----createVectorConifersBroadleaved-------------------------------\nlevels(d.trees$species)\n##\n## vector of contrasts\nv.conifers_vs_broadleaved <- c(1/2, -1/2, -1/2, 1/2)\nnames(v.conifers_vs_broadleaved) <-\n  levels(d.trees$species)\n##\nv.conifers_vs_broadleaved\n\n\n## ----testConifersBroadleaved---------------------------------------\nph.test.conifers_vs_broadleaved <- glht(\n  model = lm.trees.1,\n  linfct = mcp(species = v.conifers_vs_broadleaved))\n##\nsummary(ph.test.conifers_vs_broadleaved)\n\n\n## ----THSDForSpecies------------------------------------------------\nph.test.THSD <- glht(lm.trees.1,\n                     linfct = mcp(species = \"Tukey\"))\nsummary(ph.test.THSD)\n\n\n## ----graphTHSDForSpcies, out.width='0.9\\\\linewidth'----------------\n## 1) change margins default\npar(\"mar\")\npar(mar = c(5.1,7.5,4.1,2.1))\n##\n## 2) plot contrasts\nplot(ph.test.THSD)\n\n\n## ----matrixForPHContrasts------------------------------------------\nM.ph.test.mat.1 <- rbind(\n  \"Beech vs Larch\" = c(1, -1, 0, 0),\n  \"Spruce vs Oak\" = c(0, 0, 1,-1),\n  \"Beech vs Oak & Spruce\" = c(1, 0, -1/2, -1/2),\n  \"F - L vs Q - P\" = c(1, -1, 1, -1))\ncolnames(M.ph.test.mat.1) <- levels(d.trees$species)\n##\nM.ph.test.mat.1\n\n\n## ----testingPHMAtrix-----------------------------------------------\nph.test.mat.1 <- glht(\n  model = lm.trees.1,\n  linfct = mcp(species = M.ph.test.mat.1))\n##\nsummary(ph.test.mat.1)\n\n\n## ----conifersYES---------------------------------------------------\nd.trees$conifers.YES <- d.trees$species %in% c(\"Larch\", \"Spruce\")\n##\ntable(d.trees$species,\n      d.trees$conifers.YES)\n\n\n## ----LmTreesConifersYes--------------------------------------------\nlm.trees.conifers <- update(lm.trees.1, . ~ . + conifers.YES) \n##\nsummary(lm.trees.conifers)\n\n\n## ----addingInteractionSpeciesage-----------------------------------\nlm.trees.5 <- update(lm.trees.4, \n                     . ~ . + age:species)\n##\ndrop1(lm.trees.5, test = \"F\")\n\n\n## ----ageEffect, message=FALSE--------------------------------------\nlibrary(ggplot2)\nggplot(data = d.trees,\n       mapping = aes(y = growth.rate,\n                     x = age)) +\n  geom_point() + ## adds observations\n  geom_smooth(method = \"lm\") ## adds the regression line with CI\n\n\n## ----ageEffectBySpecies--------------------------------------------\nggplot(data = d.trees,\n       mapping = aes(y = growth.rate,\n                     x = age)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") +\n  facet_grid(. ~ species)\n\n\n## ----lm.trees1again------------------------------------------------\nsummary(lm.trees.1)\n##\ndrop1(lm.trees.1, test = \"F\")\n\n\n## ----relevelSpecies------------------------------------------------\nd.trees$species.relevelled <- relevel(d.trees$species, \n                                      ref = \"Oak\")\n##\nlm.trees.1.relevelled <- update(lm.trees.1, \n                                . ~ . -species + species.relevelled)\n\n\n## ----pValuesRelevelledLm1------------------------------------------\nsummary(lm.trees.1.relevelled)\n##\ndrop1(lm.trees.1.relevelled, test = \"F\")\n\n\n## ----sessionINfo, size='footnotesize'------------------------------\nsessionInfo()\n\n"}